# 新機能の要件定義

## 機能1: メッセージ送信フォームの改良

### 現在の機能
- Streamlitアプリで配信対象を選択してメッセージを送信
- 配信希望情報（学生向け、イベント・研修会情報のみ、すべての情報）でフィルタリング

### 追加する機能

#### 入力項目
1. **配信対象の選択**
   - 配信希望情報でフィルタリング（既存機能）
   - 追加: 支部でのフィルタリング
   - 追加: 会員情報（A会員、B会員、学生会員）でのフィルタリング
   - 追加: 個別選択（チェックボックスで複数選択）

2. **題名（タイトル）**
   - 必須項目
   - テキスト入力

3. **詳細テキスト**
   - 必須項目
   - 複数行テキストエリア
   - 改行対応

4. **画像**
   - オプション
   - 1枚の画像をアップロード
   - 画像ファイル（JPEG、PNG）

5. **リンク（URL）**
   - オプション
   - Googleフォームや詳細ページのURL
   - クリック可能なリンクとして表示

#### 送信されるメッセージ形式
- 題名（タイトル）
- 詳細テキスト
- 画像（アップロードされた場合）
- リンクボタン（URLが指定された場合）

---

## 機能2: LINEリッチメニューの実装

### リッチメニューとは
LINE Botの画面下部に表示されるメニュー。タップでアクションを実行できる。

### 実装するメニュー項目

#### メニュー1: 会員登録情報変更
- **アクション**: 会員登録フォームへのリンク
- **URL**: `https://line-tool.onrender.com/register?user_id={user_id}`
- **説明**: 会員情報を変更する

#### メニュー2: 申し込み中のイベント・研修会一覧
- **アクション**: イベント一覧ページへのリンク
- **URL**: `https://line-tool.onrender.com/events?user_id={user_id}`
- **説明**: 現在申し込んでいるイベント・研修会を確認

#### メニュー3: 会員情報確認
- **アクション**: 会員情報確認ページへのリンク
- **URL**: `https://line-tool.onrender.com/profile?user_id={user_id}`
- **説明**: 現在の登録情報を確認

### 必要な実装

#### 1. イベント・研修会の申し込み機能
- イベント情報の保存（CSVまたはデータベース）
- 申し込み機能
- 申し込み一覧の表示

#### 2. 会員情報確認機能
- 現在の登録情報を表示
- 編集リンクの提供

#### 3. リッチメニューの設定
- LINE Developersでリッチメニューを作成
- メニュー項目の設定
- アクションの設定

---

## 実装の優先順位

### フェーズ1: メッセージ送信フォームの改良（優先度：高）
1. 題名、詳細テキスト、画像、リンクの入力項目を追加
2. 画像アップロード機能の実装
3. リッチメッセージ（画像+リンク）の送信機能

### フェーズ2: 会員情報確認機能（優先度：中）
1. 会員情報確認ページの実装
2. リッチメニューに「会員情報確認」を追加

### フェーズ3: イベント・研修会機能（優先度：中）
1. イベント情報の保存機能
2. 申し込み機能
3. 申し込み一覧の表示

### フェーズ4: リッチメニューの完全実装（優先度：中）
1. すべてのメニュー項目の実装
2. LINE Developersでの設定

---

## 技術的な考慮事項

### 画像の保存
- Renderの無料プランでは永続ストレージが限られている
- オプション1: 画像をBase64エンコードしてLINEに直接送信（推奨）
- オプション2: 外部ストレージ（AWS S3、Google Cloud Storage）を使用

### イベント情報の保存
- CSVファイルで管理（既存のmembers.csvと同様）
- または、別のCSVファイル（events.csv）を作成

### リッチメニューの設定
- LINE Developersコンソールで設定
- メニュー画像の作成が必要
- アクションタイプ: URIアクション（URL遷移）

---

## 次のステップ

1. **メッセージ送信フォームの改良**から開始
2. 段階的に機能を追加
3. 各機能のテストを実施

