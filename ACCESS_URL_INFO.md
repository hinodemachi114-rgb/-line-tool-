# アクセスURLについて

## アクセスするためのURL

会員登録フォームにアクセスするためのURLは、以下の形式になります：

```
{BASE_URL}/register?user_id={LINEのユーザーID}
```

### 具体例

#### 1. ローカルネットワーク（同じWi-Fi）の場合
```
http://192.168.1.100:5000/register?user_id=U1234567890abcdef
```

#### 2. ngrokを使用して外部公開する場合
```
https://xxxx-xxxx.ngrok-free.app/register?user_id=U1234567890abcdef
```

## BASE_URLの確認方法

### 方法1: サーバー起動時のログを確認

サーバーを起動すると、以下のようにBASE_URLが表示されます：

```
============================================================
サーバーを起動しています...
ベースURL: http://192.168.1.100:5000
フォームURL: http://192.168.1.100:5000/register
============================================================
```

### 方法2: LINE Botから送られるURLを使用（推奨）

LINE Botにメッセージを送信すると、自動的に正しいURLを含むリンクが送信されます。
このリンクをクリックするだけで、会員登録フォームにアクセスできます。

## 使い方

### 通常の使用方法（推奨）

1. LINE Botにメッセージを送信（何でもOK）
2. Botから送られてくるリンクをクリック
3. フォームが表示される

### 手動でURLを構築する場合

もし手動でURLを作成する場合は：

1. サーバーを起動してBASE_URLを確認
2. LINEのユーザーIDを取得（Botのログに表示されます）
3. URLを構築: `{BASE_URL}/register?user_id={ユーザーID}`

## 外部公開（ngrok使用）の場合

### ステップ1: ngrokを起動
```bash
ngrok http 5000
```

### ステップ2: ngrokのURLを確認
ngrokの画面に表示されるURLをコピーします：
```
Forwarding  https://xxxx-xxxx.ngrok-free.app -> http://localhost:5000
```

### ステップ3: 環境変数を設定
```powershell
$env:BASE_URL="https://xxxx-xxxx.ngrok-free.app"
python server.py
```

### ステップ4: LINE Botにメッセージを送信
LINE Botから送られてくるURLは、自動的にngrokのURLになります。

## セキュリティ

⚠️ **重要な注意事項：**

- `/register`エンドポイントは、`user_id`パラメータが必須です
- `user_id`がない場合や不正な場合は、アクセスが拒否されます
- このため、LINE Botから送られたリンクのみが有効です

## トラブルシューティング

### アクセスできない場合

1. **サーバーが起動しているか確認**
   ```bash
   python server.py
   ```

2. **BASE_URLを確認**
   - サーバー起動時のログを確認
   - 環境変数BASE_URLが設定されているか確認

3. **ファイアウォールの確認**
   - ポート5000がブロックされていないか確認

4. **ネットワークの確認**
   - 同じWi-Fiネットワークに接続しているか（ローカルアクセスの場合）
   - ngrokが正しく起動しているか（外部公開の場合）

